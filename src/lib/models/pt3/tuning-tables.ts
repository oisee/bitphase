// PT3 note tables, taken from Vortex Tracker II sources

// Table #0 of Pro Tracker 3.4x - 3.5x
export const PT3ToneTable_0: number[] = [
	0x0c22, 0x0b73, 0x0acf, 0x0a33, 0x09a1, 0x0917, 0x0894, 0x0819, 0x07a4, 0x0737, 0x06cf, 0x066d,
	0x0611, 0x05ba, 0x0567, 0x051a, 0x04d0, 0x048b, 0x044a, 0x040c, 0x03d2, 0x039b, 0x0367, 0x0337,
	0x0308, 0x02dd, 0x02b4, 0x028d, 0x0268, 0x0246, 0x0225, 0x0206, 0x01e9, 0x01ce, 0x01b4, 0x019b,
	0x0184, 0x016e, 0x015a, 0x0146, 0x0134, 0x0123, 0x0112, 0x0103, 0x00f5, 0x00e7, 0x00da, 0x00ce,
	0x00c2, 0x00b7, 0x00ad, 0x00a3, 0x009a, 0x0091, 0x0089, 0x0082, 0x007a, 0x0073, 0x006d, 0x0067,
	0x0061, 0x005c, 0x0056, 0x0052, 0x004d, 0x0049, 0x0045, 0x0041, 0x003d, 0x003a, 0x0036, 0x0033,
	0x0031, 0x002e, 0x002b, 0x0029, 0x0027, 0x0024, 0x0022, 0x0020, 0x001f, 0x001d, 0x001b, 0x001a,
	0x0018, 0x0017, 0x0016, 0x0014, 0x0013, 0x0012, 0x0011, 0x0010, 0x000f, 0x000e, 0x000d, 0x000c
];

// Table #1 of Pro Tracker 3.3x - 3.5x
export const PT3ToneTable_1: number[] = [
	0x0ef8, 0x0e10, 0x0d60, 0x0c80, 0x0bd8, 0x0b28, 0x0a88, 0x09f0, 0x0960, 0x08e0, 0x0858, 0x07e0,
	0x077c, 0x0708, 0x06b0, 0x0640, 0x05ec, 0x0594, 0x0544, 0x04f8, 0x04b0, 0x0470, 0x042c, 0x03fd,
	0x03be, 0x0384, 0x0358, 0x0320, 0x02f6, 0x02ca, 0x02a2, 0x027c, 0x0258, 0x0238, 0x0216, 0x01f8,
	0x01df, 0x01c2, 0x01ac, 0x0190, 0x017b, 0x0165, 0x0151, 0x013e, 0x012c, 0x011c, 0x010a, 0x00fc,
	0x00ef, 0x00e1, 0x00d6, 0x00c8, 0x00bd, 0x00b2, 0x00a8, 0x009f, 0x0096, 0x008e, 0x0085, 0x007e,
	0x0077, 0x0070, 0x006b, 0x0064, 0x005e, 0x0059, 0x0054, 0x004f, 0x004b, 0x0047, 0x0042, 0x003f,
	0x003b, 0x0038, 0x0035, 0x0032, 0x002f, 0x002c, 0x002a, 0x0027, 0x0025, 0x0023, 0x0021, 0x001f,
	0x001d, 0x001c, 0x001a, 0x0019, 0x0017, 0x0016, 0x0015, 0x0013, 0x0012, 0x0011, 0x0010, 0x000f
];

// Table #2 of Pro Tracker 3.4x - 3.5x
export const PT3ToneTable_2: number[] = [
	0x0d10, 0x0c55, 0x0ba4, 0x0afc, 0x0a5f, 0x09ca, 0x093d, 0x08b8, 0x083b, 0x07c5, 0x0755, 0x06ec,
	0x0688, 0x062a, 0x05d2, 0x057e, 0x052f, 0x04e5, 0x049e, 0x045c, 0x041d, 0x03e2, 0x03ab, 0x0376,
	0x0344, 0x0315, 0x02e9, 0x02bf, 0x0298, 0x0272, 0x024f, 0x022e, 0x020f, 0x01f1, 0x01d5, 0x01bb,
	0x01a2, 0x018b, 0x0174, 0x0160, 0x014c, 0x0139, 0x0128, 0x0117, 0x0107, 0x00f9, 0x00eb, 0x00dd,
	0x00d1, 0x00c5, 0x00ba, 0x00b0, 0x00a6, 0x009d, 0x0094, 0x008c, 0x0084, 0x007c, 0x0075, 0x006f,
	0x0069, 0x0063, 0x005d, 0x0058, 0x0053, 0x004e, 0x004a, 0x0046, 0x0042, 0x003e, 0x003b, 0x0037,
	0x0034, 0x0031, 0x002f, 0x002c, 0x0029, 0x0027, 0x0025, 0x0023, 0x0021, 0x001f, 0x001d, 0x001c,
	0x001a, 0x0019, 0x0017, 0x0016, 0x0015, 0x0014, 0x0012, 0x0011, 0x0010, 0x000f, 0x000e, 0x000d
];

// Table #3 of Pro Tracker 3.4x - 3.5x
export const PT3ToneTable_3: number[] = [
	0x0cda, 0x0c22, 0x0b73, 0x0acf, 0x0a33, 0x09a1, 0x0917, 0x0894, 0x0819, 0x07a4, 0x0737, 0x06cf,
	0x066d, 0x0611, 0x05ba, 0x0567, 0x051a, 0x04d0, 0x048b, 0x044a, 0x040c, 0x03d2, 0x039b, 0x0367,
	0x0337, 0x0308, 0x02dd, 0x02b4, 0x028d, 0x0268, 0x0246, 0x0225, 0x0206, 0x01e9, 0x01ce, 0x01b4,
	0x019b, 0x0184, 0x016e, 0x015a, 0x0146, 0x0134, 0x0123, 0x0112, 0x0103, 0x00f5, 0x00e7, 0x00da,
	0x00ce, 0x00c2, 0x00b7, 0x00ad, 0x00a3, 0x009a, 0x0091, 0x0089, 0x0082, 0x007a, 0x0073, 0x006d,
	0x0067, 0x0061, 0x005c, 0x0056, 0x0052, 0x004d, 0x0049, 0x0045, 0x0041, 0x003d, 0x003a, 0x0036,
	0x0033, 0x0031, 0x002e, 0x002b, 0x0029, 0x0027, 0x0024, 0x0022, 0x0020, 0x001f, 0x001d, 0x001b,
	0x001a, 0x0018, 0x0017, 0x0016, 0x0014, 0x0013, 0x0012, 0x0011, 0x0010, 0x000f, 0x000e, 0x000d
];

// Table #4 Natural Cmaj/Am (Vortex Tracker II PT3NoteTable_NATURAL)
export const PT3ToneTable_4: number[] = [
	2880, 2700, 2560, 2400, 2304, 2160, 2025, 1920, 1800, 1728, 1620, 1536, 1440, 1350, 1280, 1200,
	1152, 1080, 1013, 960, 900, 864, 810, 768, 720, 675, 640, 600, 576, 540, 506, 480, 450, 432,
	405, 384, 360, 338, 320, 300, 288, 270, 253, 240, 225, 216, 203, 192, 180, 169, 160, 150, 144,
	135, 127, 120, 113, 108, 101, 96, 90, 84, 80, 75, 72, 68, 63, 60, 56, 54, 51, 48, 45, 42, 40,
	38, 36, 34, 32, 30, 28, 27, 25, 24, 23, 21, 20, 19, 18, 17, 16, 15, 14, 14, 13, 12
];

export const PT3TuneTables: number[][] = [
	PT3ToneTable_0,
	PT3ToneTable_1,
	PT3ToneTable_2,
	PT3ToneTable_3,
	PT3ToneTable_4
];

const A4_NOTE_INDEX = 45;
const TABLE_LENGTH = 96;
const MIN_PERIOD = 1;
const MAX_PERIOD = 4095;

const JUST_INTONATION_RATIOS = [
	1, 16 / 15, 9 / 8, 6 / 5, 5 / 4, 4 / 3, 64 / 45, 3 / 2, 8 / 5, 5 / 3, 16 / 9, 15 / 8
];

const NATURAL_BASE_PERIOD = 2880;

export function generateNaturalTuningTable(rootSemitone: number): number[] {
	const result: number[] = [];
	for (let i = 0; i < TABLE_LENGTH; i++) {
		const semitone = i % 12;
		const octave = Math.floor(i / 12);
		const intervalFromRoot = ((semitone - rootSemitone) % 12 + 12) % 12;
		const rootRelativeOctave = octave - (semitone < rootSemitone ? 1 : 0);
		const freqRatio = JUST_INTONATION_RATIOS[intervalFromRoot];
		let period = Math.round(NATURAL_BASE_PERIOD / freqRatio / Math.pow(2, rootRelativeOctave));
		if (period > MAX_PERIOD) period = MAX_PERIOD;
		if (period < MIN_PERIOD) period = MIN_PERIOD;
		result.push(period);
	}
	return result;
}

export function generate12TETTuningTable(chipFrequencyHz: number, a4Hz: number = 440): number[] {
	const result: number[] = [];
	for (let i = 0; i < TABLE_LENGTH; i++) {
		const freqHz = a4Hz * Math.pow(2, (i - A4_NOTE_INDEX) / 12);
		const periodF = chipFrequencyHz / 16 / freqHz;
		let period = Math.round(periodF);
		if (period > MAX_PERIOD) period = MAX_PERIOD;
		if (period < MIN_PERIOD) period = MIN_PERIOD;
		result.push(period);
	}
	return result;
}
